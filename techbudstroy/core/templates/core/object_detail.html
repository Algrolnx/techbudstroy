{% extends 'core/base.html' %}
{% block title %}{{ object.title }} - –¢–µ—Ö–ë—É–¥-–°—Ç—Ä–æ–π{% endblock %}
{% block header %}–î–µ—Ç–∞–ª—ñ –æ–±'—î–∫—Ç–∞{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-4 mb-4">
        <div class="card card-custom p-3">
            <h5 class="mb-2">{{ object.title }}</h5>
            <p class="text-muted mb-2">üìç {{ object.address }}</p>
            <hr class="my-2">
            <p class="mb-1"><strong>–ó–∞–º–æ–≤–Ω–∏–∫:</strong> {{ object.client.name }}</p>
            <p class="mb-1"><strong>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å:</strong> {{ object.company.name }}</p>
            <p class="mb-3"><strong>–ü–ª–æ—â–∞:</strong> {{ object.area }} –º¬≤</p>
            <a href="{% url 'admin:core_constructionobject_change' object.pk %}"
                class="btn btn-sm btn-outline-primary mb-1">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
            <a href="{% url 'admin:core_constructionobject_delete' object.pk %}"
                class="btn btn-sm btn-outline-danger">–ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏</a>
        </div>
    </div>

    <div class="col-md-8 mb-4">
        <div class="card card-custom p-3">
            <ul class="nav nav-tabs mb-3">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab"
                        data-bs-target="#stages">–ï—Ç–∞–ø–∏</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#materials">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab"
                        data-bs-target="#finance">–§—ñ–Ω–∞–Ω—Å–∏</button></li>
            </ul>
            <div class="tab-content">

                <div class="tab-pane fade show active" id="stages">
                    <div class="text-end mb-2"><a href="/admin/core/constructionstage/add/"
                            class="btn btn-sm btn-success text-white">+ –ï—Ç–∞–ø</a></div>
                    {% for stage in object.constructionstage_set.all %}
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <strong>{{ stage.name }}</strong>
                            <span>{{ stage.progress_percent }}% <a
                                    href="{% url 'admin:core_constructionstage_change' stage.id %}"
                                    class="text-muted ms-1">‚úé</a></span>
                        </div>
                        <div class="progress mt-1 progress-sm">
                            <div class="progress-bar bg-success" style="width:{{ stage.progress_percent }}%"></div>
                        </div>
                    </div>
                    {% empty %}<p class="text-muted">–ï—Ç–∞–ø–∏ –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ.</p>
                    {% endfor %}
                </div>

                <div class="tab-pane fade" id="materials">
                    <div class="text-end mb-2"><a href="/admin/core/materialusage/add/"
                            class="btn btn-sm btn-success text-white">+ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</a></div>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>–ú–∞—Ç–µ—Ä—ñ–∞–ª</th>
                                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                                <th>–î–∞—Ç–∞</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for usage in object.materialusage_set.all %}
                            <tr>
                                <td>{{ usage.material.name }}</td>
                                <td>{{ usage.quantity }} {{ usage.material.unit }}</td>
                                <td>{{ usage.date_used }}</td>
                                <td><a href="{% url 'admin:core_materialusage_change' usage.id %}"
                                        class="text-muted">‚úé</a></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-muted text-center">–ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ —â–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—å</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <div class="tab-pane fade" id="finance">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">–î–æ–≥–æ–≤–æ—Ä–∏</h6>
                        <a href="/admin/core/contract/add/" class="btn btn-sm btn-outline-primary">+ –î–æ–≥–æ–≤—ñ—Ä</a>
                    </div>
                    <table class="table table-sm table-bordered mb-4">
                        <thead class="table-light">
                            <tr>
                                <th>‚Ññ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–°—É–º–∞</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for contract in object.contract_set.all %}
                            <tr>
                                <td>{{ contract.contract_number }}</td>
                                <td>{{ contract.status }}</td>
                                <td>{{ contract.total_amount }} –≥—Ä–Ω</td>
                                <td><a href="{% url 'admin:core_contract_change' contract.id %}"
                                        class="text-muted">‚úé</a></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-muted text-center">–ù–µ–º–∞—î –¥–æ–≥–æ–≤–æ—Ä—ñ–≤</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <h6>–ü–ª–∞—Ç–µ–∂—ñ</h6>
                    <table class="table table-sm table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–¢–∏–ø</th>
                                <th>–°—É–º–∞</th>
                                <th>–î–æ–≥–æ–≤—ñ—Ä</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for contract in object.contract_set.all %}
                            {% for payment in contract.payment_set.all %}
                            <tr>
                                <td>{{ payment.payment_date }}</td>
                                <td>{% if payment.payment_type == 'IN' %}<span class="text-success">‚Üì –ü—Ä–∏—Ö—ñ–¥</span>{%
                                    else %}<span class="text-danger">‚Üë –í–∏—Ç—Ä–∞—Ç–∞</span>{% endif %}</td>
                                <td><strong>{{ payment.amount }}</strong></td>
                                <td>{{ contract.contract_number }}</td>
                                <td><a href="{% url 'admin:core_payment_change' payment.id %}" class="text-muted">‚úé</a>
                                </td>
                            </tr>
                            {% endfor %}
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-muted text-center">–ü–ª–∞—Ç–µ–∂—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}